<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Al GENZO HACK 2025</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body, html {
      background:#000;
      color:#fff;
      font-family:Arial, sans-serif;
      height:100vh;
      overflow:hidden;
      user-select:none;
      -webkit-tap-highlight-color:transparent;
    }
    .hidden { display:none !important; }

    :root {
      --unit: calc(100vw / 100);
    }

    /* === МЕНЮ === */
    #menu {
      height:100vh;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      background:radial-gradient(circle at center,#1a0033,#000);
      text-align:center;
      padding: 4vh 3vw;
      gap: 3vh;
    }

    .lang-switcher {
      display: flex;
      gap: 3vw;
      z-index: 1000;
    }
    .lang-flag {
      width: clamp(36px, 8vw, 48px);
      height: clamp(36px, 8vw, 48px);
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 0 18px rgba(255,255,255,0.3);
      opacity: 0.7;
      border: 2px solid rgba(255,255,255,0.1);
    }
    .lang-flag.active {
      opacity: 1;
      transform: scale(1.2);
      box-shadow: 0 0 30px rgba(255,255,255,0.7);
      border-color: #fff;
    }

    #menu .games-row {
      display: flex;
      justify-content: center;
      gap: 6vw;
      flex-wrap: wrap;
      width: 100%;
      max-width: 90vw;
    }
    .game-card {
      width: clamp(120px, 40vw, 160px);
      cursor: pointer;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 14px 45px rgba(156,39,176,0.7);
      transition: all 0.3s ease;
      position: relative;
    }
    .game-card img {
      width: 100%;
      height: auto;
      display: block;
      border-radius: 16px;
    }
    .game-card .game-label {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(180deg, transparent, rgba(0,0,0,0.85));
      color: #fff;
      font-size: clamp(18px, 5vw, 26px);
      font-weight: bold;
      padding: 20px 12px 12px;
      text-align: center;
      text-shadow: 0 0 15px #000;
    }
    .game-card:hover {
      transform: scale(1.08);
      box-shadow: 0 20px 60px rgba(156,39,176,0.9);
    }
    #menu h1 {
      font-size: clamp(28px, 8vw, 38px);
      margin: 0;
      text-shadow: 0 0 30px #e040fb;
      color: #fff;
    }

    .game-screen {
      height:100vh;
      position:relative;
      background:#0a001f;
      overflow: hidden;
    }
    .back {
      position: absolute;
      background: none;
      border: none;
      font-weight: bold;
      cursor: pointer;
      z-index: 100;
      font-size: clamp(24px, 6vw, 30px);
      color: #fff;
    }

    /* === LUCKY JET === */
    #preview {
      position:fixed; top:0; left:0; width:100%; height:100%; background:#000;
      display:flex; flex-direction:column; justify-content:center; align-items:center;
      cursor:pointer; z-index:9999;
      padding: 5vh 5vw;
    }
    #preview img { 
      width:90%; 
      max-width:400px; 
      border-radius:20px; 
    }
    .play-btn {
      margin-top: 4vh;
      background:#00ff00;
      color:#000;
      padding: clamp(14px, 4vw, 18px) clamp(40px, 12vw, 50px);
      border-radius:50px;
      font-weight:bold;
      font-size: clamp(18px, 5vw, 22px);
      box-shadow:0 0 25px #0f0;
      animation:pulse 1.5s infinite;
    }

    #game-bg.moving-bg {
      position:absolute;
      width:200%;
      height:100%;
      object-fit:cover;
      animation: moveBg 140s linear infinite;
      filter:brightness(0.8);
    }
    @keyframes moveBg { 0% { transform:translateX(0); } 100% { transform:translateX(-50%); } }

    #stars {
      position:absolute;
      width:200%;
      height:100%;
      background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="150" height="150"><circle cx="30" cy="30" r="1.5" fill="white"/><circle cx="100" cy="20" r="1" fill="white"/><circle cx="60" cy="90" r="1.8" fill="white"/><circle cx="120" cy="110" r="1.2" fill="white"/></svg>') repeat;
      background-size:120px;
      opacity:0.8;
      animation: starsMove 100s linear infinite;
    }
    @keyframes starsMove { 0% { transform:translateX(0); } 100% { transform:translateX(-50%); } }

    #clouds {
      position:absolute; width:200%; height:40%; bottom:0;
      background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 30"><path d="M0,25 Q15,20 30,25 T60,25 Q75,20 90,25 L100,30 L0,30 Z" fill="%236a1b9a" opacity="0.25"/></svg>') repeat-x;
      background-size:180px 60px;
      animation:clouds 60s linear infinite;
    }
    @keyframes clouds { from { background-position:0 0; } to { background-position:-400px 0; } }

    #header-title {
      position:absolute;
      top: 25%;
      left:50%;
      transform:translateX(-50%);
      width: clamp(200px, 60vw, 280px);
      z-index:100;
    }

    #preloader {
      position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.97);
      display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:999;
    }
    .loader { width: clamp(60px, 15vw, 80px); height: clamp(60px, 15vw, 80px); animation:spin 1.5s linear infinite; }
    @keyframes spin { from { transform:rotate(0deg); } to { transform:rotate(360deg); } }

    #center-orbit {
      position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
      width: clamp(240px, 70vw, 300px); height: clamp(240px, 70vw, 300px); z-index:10;
    }
    #multiplier {
      position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
      font-size: clamp(50px, 15vw, 76px); font-weight:bold; color:#e040fb; text-shadow:0 0 30px #e040fb; z-index:5;
    }
    #jetman-container {
      position:absolute; width: clamp(100px, 25vw, 130px); height: clamp(100px, 25vw, 130px); top:50%; left:50%;
      transform:translate(-50%,-50%);
      animation:orbit 10s linear infinite;
    }
    @keyframes orbit {
      0% { transform:translate(-50%,-50%) rotate(0deg) translateX(140px) rotate(0deg); }
      100% { transform:translate(-50%,-50%) rotate(360deg) translateX(140px) rotate(-360deg); }
    }
    #jetman {
      position:absolute; width:100%; top:50%; left:50%; transform:translate(-50%,-50%);
      filter:drop-shadow(0 0 20px #ff9800);
    }
    #fire {
      position:absolute; width:60%; bottom:-35%; left:50%; transform:translateX(-50%);
      animation:fire 0.3s infinite alternate;
    }
    @keyframes fire { 0% { opacity:0.8; } 100% { opacity:1; transform:scale(1.2) translateY(-6px); } }

    #lucky-timer {
      position: absolute;
      bottom: 8vh;
      left: 50%;
      transform: translateX(-50%);
      width: clamp(200px, 70vw, 300px);
    }
    #get-signal {
      width: 100%;
      background: #9c27b0;
      color: #fff;
      border: none;
      padding: clamp(16px, 4vh, 20px) 0;
      border-radius: 40px;
      font-weight: bold;
      font-size: clamp(18px, 5vw, 22px);
      cursor: pointer;
      box-shadow: 0 0 35px #ba68c8;
      transition: all 0.3s ease;
    }
    #get-signal:disabled { background: #666; cursor: not-allowed; }

    .progress-ring {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%) rotate(-90deg);
      width: clamp(120px, 35vw, 160px);
      height: clamp(120px, 35vw, 160px);
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .timer-button.countdown .progress-ring { opacity: 1; }
    .progress-ring__circle { stroke:#333; stroke-width:5; fill:transparent; }
    .progress-ring__progress { stroke:#ba68c8; stroke-width:8; fill:transparent; stroke-linecap:round; }

    /* === MINES === */
    #mines-header {
      position: absolute;
      top: 2vh;
      left: 50%;
      transform: translateX(-50%);
      width: 90vw;
      max-width: 460px;
      z-index: 100;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 2vw;
    }
    #mines-header .back {
      position: static;
      font-size: clamp(24px, 6vw, 30px);
      color: #00d4ff;
      text-shadow: 0 0 20px #00aaff;
    }
    #mines-header .mines-title {
      font-size: clamp(32px, 9vw, 42px);
      color: #00d4ff;
      text-shadow: 0 0 30px #00aaff;
      font-weight: bold;
    }

    /* СЕТКА — В ЦЕНТРЕ */
    #mines-field {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: clamp(8px, 2vw, 11px);
      max-width: 90vw;
      margin: 14vh auto 3vh; /* Отступ сверху и снизу */
      padding: 0 2vw;
    }
    .mine-tile {
      position: relative;
      aspect-ratio: 1;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 8px 25px rgba(0,170,255,0.3);
    }
    .mine-tile img.closed {
      width: 100%; height: 100%;
      transition: opacity 0.5s ease;
    }
    .mine-tile.opened img.closed { opacity: 0; }
    .mine-tile .star {
      position: absolute; top: 50%; left: 50%;
      transform: translate(-50%,-50%) scale(0);
      width: 48px; height: 48px;
      opacity: 0;
      transition: all 0.6s ease;
    }
    .mine-tile.opened .star {
      transform: translate(-50%,-50%) scale(1);
      opacity: 1;
    }

    /* КНОПКИ ПОД СЕТКОЙ */
    .mines-controls {
      position: static;
      margin: 0 auto 4vh;
      width: 90vw;
      max-width: 460px;
      text-align: center;
      padding: 0 2vw;
    }
    .mines-count span {
      font-size: clamp(20px, 5vw, 24px);
      color: #00eeff;
      margin-right: 8px;
    }
    .count-btns button {
      margin: 0 4px;
      padding: clamp(10px, 2.5vw, 14px) clamp(16px, 4vw, 20px);
      background: #002233;
      border: 2px solid #004466;
      border-radius: 16px;
      color: #fff;
      font-weight: bold;
      font-size: clamp(16px, 4.5vw, 18px);
      cursor: pointer;
    }
    .count-btns button.active {
      background: #0088ff !important;
      border-color: #00ccff;
      box-shadow: 0 0 30px #0088ff;
      transform: scale(1.15);
    }
    .mines-info {
      font-size: clamp(26px, 7vw, 32px);
      color: #00eeff;
      margin-top: 8px;
    }

    .mines-panel.blue {
      position: fixed;
      bottom: 0; left: 0; right: 0;
      background: linear-gradient(180deg, #001122, #000b1f);
      padding: 4vh 3vw;
      text-align: center;
      border-top: 3px solid #00d4ff;
      box-shadow: 0 0 35px rgba(0,212,255,0.5);
    }
    #mines-timer button {
      width: clamp(200px, 70vw, 300px);
      background: linear-gradient(45deg, #0066ff, #00aaff);
      color: #fff;
      padding: clamp(14px, 3.5vh, 16px) 0;
      border-radius: 35px;
      font-size: clamp(18px, 5vw, 20px);
      font-weight: bold;
      border: none;
      cursor: pointer;
      box-shadow: 0 12px 30px rgba(0,102,255,0.7);
    }

    @keyframes pulse { 0%,100% { transform:scale(1); } 50% { transform:scale(1.12); } }
  </style>
</head>
<body>

  <!-- МЕНЮ -->
  <div id="menu">
    <div class="games-row">
      <div class="game-card" onclick="openLuckyJet()">
        <img src="https://i.ibb.co/23c4Pc2x/luckyjet-preview.jpg" alt="Lucky Jet">
        <div class="game-label" data-key="luckyjet">Lucky Jet</div>
      </div>
      <div class="game-card" onclick="openMines()">
        <img src="https://i.ibb.co/dZWZcx0/mines-preview.jpg" alt="Mines">
        <div class="game-label" data-key="mines">Mines</div>
      </div>
    </div>
    <div class="lang-switcher">
      <img src="https://flagcdn.com/48x36/ru.png" alt="RU" class="lang-flag" onclick="setLanguage('ru')">
      <img src="https://flagcdn.com/48x36/gb.png" alt="EN" class="lang-flag" onclick="setLanguage('en')">
      <img src="https://flagcdn.com/48x36/tr.png" alt="TR" class="lang-flag active" onclick="setLanguage('tr')">
    </div>
    <h1 data-key="title">Al GENZO HACK 2025</h1>
  </div>

  <!-- LUCKY JET -->
  <div id="luckyjet" class="game-screen hidden">
    <div id="preview" onclick="startLuckyJet()">
      <img src="https://i.ibb.co/23c4Pc2x/luckyjet-preview.jpg" alt="Lucky Jet">
      <div class="play-btn" data-key="play">OYNA</div>
    </div>
    <div id="lucky-game" class="hidden">
      <img id="game-bg" src="https://i.ibb.co/8YQbV3w/background.jpg" class="moving-bg" onerror="this.style.display='none'">
      <div id="stars"></div>
      <div id="clouds"></div>
      
      <div id="header-title">
        <svg viewBox="0 0 300 80" width="clamp(200px, 60vw, 280px)" height="80">
          <text x="150" y="50" font-family="Arial Black, sans-serif" font-size="32" font-weight="bold" 
                fill="#e040fb" text-anchor="middle" stroke="#fff" stroke-width="1.5" stroke-opacity="0.8">
            LUCKY JET
          </text>
        </svg>
      </div>
      
      <div id="preloader">
        <div class="loader" style="border: 4px solid #333; border-top: 4px solid #e040fb; border-radius: 50%;"></div>
        <p data-key="loading" style="margin-top: 20px; font-size: clamp(16px, 4vw, 20px);">Yükleniyor...</p>
      </div>
      
      <div id="center-orbit">
        <div id="multiplier">x1.00</div>
        <div id="jetman-container">
          <div style="position:absolute; width:100px; height:100px; top:50%; left:50%; transform:translate(-50%,-50%);">
            <div style="position:absolute; width:60px; height:60px; bottom:-30px; left:50%; transform:translateX(-50%); background:linear-gradient(45deg, #ff6b00, #ff9800); border-radius:50% 50% 50% 50%/60% 60% 40% 40%; animation:fire 0.3s infinite alternate;"></div>
            <img id="jetman" src="https://i.ibb.co/8YQbV3w/jetman.png" style="width:80%; filter:drop-shadow(0 0 20px #ff9800);" onerror="this.src='https://via.placeholder.com/80x80/ff9800/000?text=ROCKET'">
          </div>
        </div>
      </div>
      
      <div class="timer-button" id="lucky-timer">
        <button id="get-signal" onclick="generateLuckySignal()" data-key="get_signal">SİNYAL AL</button>
        <svg class="progress-ring" viewBox="0 0 160 160">
          <circle class="progress-ring__circle" cx="80" cy="80" r="72"/>
          <circle class="progress-ring__progress" cx="80" cy="80" r="72"/>
        </svg>
      </div>
      <button class="back" onclick="backToMenu()" style="top:4vh; color:#fff;" data-key="back">Geri</button>
    </div>
  </div>

  <!-- MINES -->
  <div id="mines" class="game-screen hidden">
    <div id="mines-header">
      <button class="back" onclick="backToMenu()" data-key="back">Geri</button>
      <h2 class="mines-title" data-key="mines">Mines</h2>
    </div>

    <!-- СЕТКА -->
    <div id="mines-field"></div>

    <!-- КНОПКИ ПОД СЕТКОЙ -->
    <div class="mines-controls">
      <div class="mines-count">
        <span data-key="mines_count">Mayın:</span>
        <div class="count-btns">
          <button onclick="setMines(1)">1</button>
          <button onclick="setMines(3)">3</button>
          <button onclick="setMines(5)">5</button>
          <button onclick="setMines(7)" class="active">7</button>
        </div>
      </div>
      <div class="mines-info">
        <span data-key="opened_text">Açıldı:</span> <span id="opened">0</span>/25
      </div>
    </div>

    <!-- КНОПКА СИГНАЛА -->
    <div class="mines-panel blue">
      <div class="timer-button" id="mines-timer">
        <button id="signal-btn" onclick="getMinesSignal()" data-key="new_signal">YENİ SİNYAL</button>
        <svg class="progress-ring" viewBox="0 0 180 180">
          <circle class="progress-ring__circle" cx="90" cy="90" r="80"/>
          <circle class="progress-ring__progress" cx="90" cy="90" r="80"/>
        </svg>
      </div>
    </div>
  </div>

<script>
Telegram?.WebApp?.ready();
Telegram?.WebApp?.expand();

const translations = {
  ru: { title: "Al GENZO HACK 2025", luckyjet: "Lucky Jet", mines: "Mines", play: "ИГРАТЬ", loading: "Загрузка...", get_signal: "ПОЛУЧИТЬ СИГНАЛ", back: "Назад", mines_count: "Мин:", opened_text: "Открыто:", new_signal: "НОВЫЙ СИГНАЛ", alert_lucky: (c) => `СИГНАЛ x${c}\nУЛЁТ 100% — ЗАБИРАЙ РАНЬШЕ ЧЕМ УКАЗАНО!`, alert_mines: (n) => `СИГНАЛ ГОТОВ!\nОткрыто ${n} безопасных ячеек\n\nСтавь — 100% профит!` },
  en: { title: "Al GENZO HACK 2025", luckyjet: "Lucky Jet", mines: "Mines", play: "PLAY", loading: "Loading...", get_signal: "GET SIGNAL", back: "Back", mines_count: "Mines:", opened_text: "Opened:", new_signal: "NEW SIGNAL", alert_lucky: (c) => `SIGNAL x${c}\n100% FLY — CASH OUT EARLY!`, alert_mines: (n) => `SIGNAL READY!\n${n} safe cells opened\n\nBet — 100% profit!` },
  tr: { title: "Al GENZO HACK 2025", luckyjet: "Lucky Jet", mines: "Mines", play: "OYNA", loading: "Yükleniyor...", get_signal: "SİNYAL AL", back: "Geri", mines_count: "Mayın:", opened_text: "Açıldı:", new_signal: "YENİ SİNYAL", alert_lucky: (c) => `SİNYAL x${c}\n%100 UÇUŞ — BELİRTİLEN DEN ÖNCE ÇEK!`, alert_mines: (n) => `SİNYAL HAZIR!\n${n} güvenli hücre açıldı\n\nBahis yap — %100 kâr!` }
};
let currentLang = 'tr';

function setLanguage(lang) {
  if (!translations[lang]) return;
  currentLang = lang;
  document.querySelectorAll('[data-key]').forEach(el => {
    const key = el.getAttribute('data-key');
    const text = translations[lang][key];
    if (typeof text === 'function') return;
    el.textContent = text;
  });
  document.querySelectorAll('.lang-flag').forEach(f => {
    f.classList.toggle('active', f.getAttribute('alt').toUpperCase() === lang.toUpperCase());
  });
  const getSignalBtn = document.getElementById('get-signal');
  if (getSignalBtn) getSignalBtn.textContent = translations[lang].get_signal;
  const newSignalBtn = document.getElementById('signal-btn');
  if (newSignalBtn) newSignalBtn.textContent = translations[lang].new_signal;
}

if (Telegram?.WebApp?.initDataUnsafe?.user?.language_code) {
  const code = Telegram.WebApp.initDataUnsafe.user.language_code.toLowerCase();
  const lang = code.includes('tr') ? 'tr' : code.includes('ru') ? 'ru' : 'en';
  setLanguage(lang);
} else {
  setLanguage('tr');
}

function openLuckyJet() { hideAll(); document.getElementById('luckyjet').classList.remove('hidden'); setLanguage(currentLang); }
function openMines() { hideAll(); document.getElementById('mines').classList.remove('hidden'); createMinesGrid(); setLanguage(currentLang); }
function backToMenu() { hideAll(); document.getElementById('menu').classList.remove('hidden'); setLanguage(currentLang); }
function hideAll() { document.querySelectorAll('.game-screen, #menu').forEach(el => el.classList.add('hidden')); }

function startLuckyJet() {
  document.getElementById('preview').classList.add('hidden');
  document.getElementById('lucky-game').classList.remove('hidden');
  setTimeout(() => document.getElementById('preloader').style.display = 'none', 1500);
}
let isFirstLuckySignal = true;
let luckyCooldown = false;
function startLuckyCooldown() {
  const btn = document.getElementById('get-signal');
  const timerBtn = document.getElementById('lucky-timer');
  const progressCircle = timerBtn.querySelector('.progress-ring__progress');
  luckyCooldown = true;
  btn.disabled = true;
  btn.textContent = "15";
  timerBtn.classList.add('countdown');
  const circumference = 2 * Math.PI * 72;
  progressCircle.style.strokeDasharray = `${circumference} ${circumference}`;
  progressCircle.style.strokeDashoffset = circumference;
  let timeLeft = 15;
  const interval = setInterval(() => {
    timeLeft--;
    btn.textContent = timeLeft > 0 ? timeLeft : translations[currentLang].get_signal;
    const offset = circumference - (timeLeft / 15) * circumference;
    progressCircle.style.strokeDashoffset = offset;
    if (timeLeft <= 0) {
      clearInterval(interval);
      luckyCooldown = false;
      btn.disabled = false;
      timerBtn.classList.remove('countdown');
      progressCircle.style.strokeDashoffset = circumference;
    }
  }, 1000);
}
function generateLuckySignal() {
  if (luckyCooldown) return;
  const btn = document.getElementById('get-signal');
  btn.disabled = true;
  btn.textContent = translations[currentLang].loading;
  setTimeout(() => {
    let coeff = isFirstLuckySignal ? 4.20 : (Math.random() * 18.5 + 1.5).toFixed(2);
    isFirstLuckySignal = false;
    document.getElementById('multiplier').textContent = `x${coeff}`;
    Telegram?.WebApp?.showAlert(translations[currentLang].alert_lucky(coeff));
    Telegram?.WebApp?.HapticFeedback?.impactOccurred('heavy');
    startLuckyCooldown();
  }, 1800);
}

let minesCount = 7;
let minesField = [];
let minesCooldown = false;

const closedCells = Array(25).fill('https://via.placeholder.com/80x80/002244/00aaff?text=?');

function createMinesGrid() {
  const field = document.getElementById('mines-field');
  field.innerHTML = '';
  document.getElementById('opened').textContent = '0';
  for (let i = 0; i < 25; i++) {
    const div = document.createElement('div');
    div.className = 'mine-tile';
    div.innerHTML = `
      <div class="closed" style="width:100%; height:100%; background:linear-gradient(45deg, #002244, #004466); display:flex; align-items:center; justify-content:center; font-size:24px; color:#00aaff;">?</div>
      <img class="star" src="https://i.ibb.co/9bY8Y8Y/star.png" onerror="this.style.display='none'">
    `;
    field.appendChild(div);
  }
}

function setMines(n) {
  minesCount = n;
  document.querySelectorAll('.count-btns button').forEach(b => b.classList.remove('active'));
  event.target.classList.add('active');
}

function startMinesCooldown() {
  const btn = document.getElementById('signal-btn');
  const timerBtn = document.getElementById('mines-timer');
  const progressCircle = timerBtn.querySelector('.progress-ring__progress');
  minesCooldown = true;
  btn.disabled = true;
  btn.textContent = "10";
  timerBtn.classList.add('countdown');
  const circumference = 2 * Math.PI * 80;
  progressCircle.style.strokeDasharray = `${circumference} ${circumference}`;
  progressCircle.style.strokeDashoffset = circumference;
  let timeLeft = 10;
  const interval = setInterval(() => {
    timeLeft--;
    btn.textContent = timeLeft > 0 ? timeLeft : translations[currentLang].new_signal;
    const offset = circumference - (timeLeft / 10) * circumference;
    progressCircle.style.strokeDashoffset = offset;
    if (timeLeft <= 0) {
      clearInterval(interval);
      minesCooldown = false;
      btn.disabled = false;
      timerBtn.classList.remove('countdown');
      progressCircle.style.strokeDashoffset = circumference;
    }
  }, 1000);
}

function getMinesSignal() {
  if (minesCooldown) return;
  createMinesGrid();
  minesField = Array(25).fill('star');
  const bombs = new Set();
  while (bombs.size < minesCount) bombs.add(Math.floor(Math.random() * 25));
  bombs.forEach(i => minesField[i] = 'bomb');
  const btn = document.getElementById('signal-btn');
  btn.textContent = translations[currentLang].loading;
  btn.disabled = true;
  setTimeout(() => {
    const tiles = document.querySelectorAll('.mine-tile');
    const openCount = minesCount === 1 ? 10 : minesCount === 3 ? 8 : minesCount === 5 ? 6 : 4;
    const safe = [];
    for (let i = 0; i < 25; i++) if (minesField[i] === 'star') safe.push(i);
    for (let i = safe.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [safe[i], safe[j]] = [safe[j], safe[i]];
    }
    let opened = 0;
    for (let i = 0; i < openCount; i++) {
      const idx = safe[i];
      setTimeout(() => {
        tiles[idx].classList.add('opened');
        document.getElementById('opened').textContent = ++opened;
      }, i * 220);
    }
    setTimeout(() => {
      Telegram?.WebApp?.showAlert(translations[currentLang].alert_mines(opened));
      Telegram?.WebApp?.HapticFeedback?.impactOccurred('heavy');
      startMinesCooldown();
    }, openCount * 220 + 1000);
  }, 800);
}
</script>

</body>
</html>
