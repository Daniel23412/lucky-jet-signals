<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lucky Jet + Мины Сигналы 2025</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>

  <!-- ГЛАВНОЕ МЕНЮ -->
  <div id="menu">
    <h1>СИГНАЛЫ 2025</h1>
    <button class="game-btn" onclick="openLuckyJet()">Lucky Jet</button>
    <button class="game-btn" onclick="openMines()">Мины</button>
  </div>

  <!-- LUCKY JET -->
  <div id="luckyjet" class="game-screen hidden">
    <div id="preview" onclick="document.getElementById('lucky-game').classList.remove('hidden'); this.classList.add('hidden')">
      <img src="assets/preview.png" alt="Lucky Jet">
      <div class="play-btn">ИГРАТЬ</div>
    </div>

    <div id="lucky-game" class="hidden">
      <img id="game-bg" src="assets/background.jpg">
      <div id="stars"></div>
      <div id="clouds"></div>
      <div id="header-title"><img src="assets/luckyjet_text.svg"></div>
      <div id="preloader"><img src="assets/preloader.svg" class="loader"><p>Загрузка...</p></div>
      <div id="center-orbit">
        <div id="multiplier">x1.00</div>
        <div id="jetman-container">
          <img id="jetman" src="assets/jetman.png">
          <img id="fire" src="assets/jetpack_fire.svg">
        </div>
      </div>
      <button id="get-signal" onclick="generateLuckySignal()">ПОЛУЧИТЬ СИГНАЛ</button>
      <button class="back" onclick="backToMenu()">Назад</button>
    </div>
  </div>

  <!-- МИНЫ -->
  <div id="mines" class="game-screen hidden">
    <div class="mines-header">
      <button class="back" onclick="backToMenu()">Назад</button>
      <h2>Мины — Автосигнал</h2>
    </div>

    <div id="mines-field"></div>

    <div class="mines-panel">
      <div class="mines-count">
        <span>Мин:</span>
        <div class="count-btns">
          <button onclick="setMines(1)">1</button>
          <button onclick="setMines(3)">3</button>
          <button onclick="setMines(5)">5</button>
          <button onclick="setMines(10)" class="active">10</button>
          <button onclick="setMines(20)">20</button>
        </div>
      </div>

      <div class="mines-info">
        <div>Кэф: <span id="coeff">1.00</span>x</div>
        <div>Открыто: <span id="opened">0</span>/25</div>
      </div>

      <button id="signal-btn" onclick="getMinesSignal()">НОВЫЙ СИГНАЛ</button>
    </div>
  </div>

<script>
// Telegram
Telegram?.WebApp?.ready();
Telegram?.WebApp?.expand();

// Глобальные переменные
let luckyIsFirst = true;
let luckyCanGet = true;
let minesCount = 10;
let minesField = [];
let minesOpened = 0;
let minesActive = false;

const closedCells = [
  "image_95509 (1).svg","image_89353 (1).svg","image_82645 (1).svg","image_75949 (1).svg",
  "image_69793 (1).svg","image_63085 (1).svg","image_56929 (1).svg","image_5450 (1).svg",
  "image_50221 (1).svg","image_44065 (1).svg","image_37357 (1).svg","image_31201 (1).svg",
  "image_24493 (1).svg","image_18337 (1).svg","image_159757 (1).svg","image_153061 (1).svg",
  "image_146917 (1).svg","image_140221 (1).svg","image_134077 (1).svg","image_127381 (1).svg",
  "image_121237 (1).svg","image_11641 (1).svg","image_115081 (1).svg","image_108373 (1).svg",
  "image_102217 (2).svg"
];

// Навигация
function openLuckyJet() { hideAll(); document.getElementById('luckyjet').classList.remove('hidden'); }
function openMines()    { hideAll(); document.getElementById('mines').classList.remove('hidden'); }
function backToMenu()   { hideAll(); document.getElementById('menu').classList.remove('hidden'); }
function hideAll() { document.querySelectorAll('.game-screen, #menu').forEach(el => el.classList.add('hidden')); }

// === LUCKY JET ===
function generateLuckySignal() {
  if (!luckyCanGet) return;
  luckyCanGet = false;
  const btn = document.getElementById('get-signal');
  btn.textContent = "Проверка... 30"; btn.disabled = true;

  let sec = 30;
  const timer = setInterval(() => {
    sec--;
    btn.textContent = `Проверка... ${sec}`;
    if (sec <= 0) { clearInterval(timer); btn.textContent = "ПОЛУЧИТЬ СИГНАЛ"; btn.disabled = false; luckyCanGet = true; }
  }, 1000);

  setTimeout(() => {
    const coeff = luckyIsFirst ? 4.20 : (Math.random() * 7 + 1.1).toFixed(2);
    luckyIsFirst = false;
    document.getElementById('multiplier').textContent = `x${coeff}`;
    Telegram?.WebApp?.showAlert(`СИГНАЛ x${coeff}\nУЛЁТ 100% — ставь быстро!`);
    Telegram?.WebApp?.HapticFeedback?.impactOccurred('heavy');
  }, 1500);
}

// === МИНЫ ===
function setMines(n) {
  minesCount = n;
  document.querySelectorAll('.count-btns button').forEach(b => b.classList.remove('active'));
  event.target.classList.add('active');
}

function startMinesRound() {
  if (minesActive) return;
  minesActive = true;
  minesOpened = 0;
  document.getElementById('coeff').textContent = '1.00';
  document.getElementById('opened').textContent = '0';

  const field = document.getElementById('mines-field');
  field.innerHTML = '';

  minesField = Array(25).fill('star');
  const bombs = new Set();
  while (bombs.size < minesCount) bombs.add(Math.floor(Math.random() * 25));
  bombs.forEach(i => minesField[i] = 'bomb');

  for (let i = 0; i < 25; i++) {
    const div = document.createElement('div');
    div.className = 'mine-tile';
    div.innerHTML = `
      <img class="closed" src="assets/mines/cells/${closedCells[i]}">
      <img class="star" src="assets/mines/star.svg">
    `;
    div.onclick = () => openTile(i, div);
    field.appendChild(div);
  }
}

function openTile(index, el) {
  if (!minesActive || el.classList.contains('opened')) return;
  el.classList.add('opened');
  minesOpened++;
  document.getElementById('opened').textContent = minesOpened;
  document.getElementById('coeff').textContent = (1 + minesOpened * 0.15).toFixed(2);

  if (minesField[index] === 'bomb') {
    setTimeout(() => {
      minesActive = false;
      Telegram?.WebApp?.showAlert('БОМБА! Проиграл!');
    }, 700);
  }
}

function getMinesSignal() {
  if (minesActive) return;
  startMinesRound();
  document.getElementById('signal-btn').textContent = 'Сигнал...';
  document.getElementById('signal-btn').disabled = true;

  setTimeout(() => {
    const tiles = document.querySelectorAll('.mine-tile');
    let toOpen = 10;

    if (minesCount === 1) toOpen = 8 + Math.floor(Math.random() * 3);
    else if (minesCount === 3) toOpen = 6 + Math.floor(Math.random() * 3);
    else if (minesCount === 5) toOpen = 4 + Math.floor(Math.random() * 3);
    else if (minesCount === 10) toOpen = 10;
    else if (minesCount === 20) toOpen = 3;

    let opened = 0;
    for (let i = 0; i < 25 && opened < toOpen; i++) {
      if (minesField[i] === 'star') {
        setTimeout(() => openTile(i, tiles[i]), opened * 170);
        opened++;
      }
    }

    setTimeout(() => {
      const koeff = (1 + opened * 0.15).toFixed(2);
      Telegram?.WebApp?.showAlert(`СИГНАЛ ГОТОВ!\nОткрыто ${opened} безопасных\nКэф: x${koeff}\n\n100% профит — ставь сейчас!`);
      Telegram?.WebApp?.HapticFeedback?.impactOccurred('heavy');
      document.getElementById('signal-btn').textContent = 'НОВЫЙ СИГНАЛ';
      document.getElementById('signal-btn').disabled = false;
    }, opened * 170 + 900);
  }, 800);
}
</script>
</body>
</html>
